# Quizit 需求说明

本文档梳理当前项目的业务需求与约束，供后续设计、开发与验证参考。

## 1. 背景与目标
- 提供一款基于 Supabase 的在线记忆与测验工具，支持闪卡练习与测验运行。
- 面向个人或小团队使用，需支持账号登录、题库管理、练习与测验成绩保存。

## 2. 角色与权限
- **游客**：可访问公开页面（如首页），无法进行需要鉴权的操作。
- **登录用户**：可创建/编辑/删除自己的 Deck，进行练习与测验，系统记录个人学习与测验数据。
- 无管理员角色说明，权限按 Supabase RLS/后端定义处理。

## 3. 功能需求
### 3.1 账号与会话
- 邮箱 + 密码登录（`/login`），登录成功后按来源路由跳转。
- 前端监听 Supabase Auth 状态，顶栏展示当前用户邮箱；提供退出登录。
- 未登录时，创建/编辑等需要鉴权的操作需提示登录。

### 3.2 目录与选择（MainSelect）
- 读取 `deck_folder_stats` 视图构建目录树，按路径展示层级。
- 面包屑导航切换当前路径；支持根路径和任意子路径。
- 展示子目录/Deck 列表（名称、Deck 数、卡片数、熟练度百分比）。
- 当前路径为 Deck 时可跳转“查看”（编辑页）与“学习”（练习页）。
- “新增”按钮携带当前路径跳转至新建 Deck 页面。
- 右侧显示该路径关联的测验模板（来自 `quiz_template_stats`），可开始测验。

### 3.3 Deck 管理
- **列表页** `/decks`：显示 Deck 名称、层级路径、描述、卡片数量、更新时间。
- 新建 Deck：标题（支持 `/` 表示层级）、描述可选；需登录。
- 编辑 Deck：可修改标题、描述，删除 Deck（用户确认）；导航可跳转练习。
- 新建入口：列表底部表单；单独的新建页 `/decks/new` 支持通过 `?path=` 预填层级，创建后跳转编辑页。

### 3.4 Deck 编辑（Card 管理）
- 读取/保存 Deck（`decks` 表）及其卡片（`cards` 表）和测验项（`quiz_items`）。
- 支持卡片增删改，包含题干(front)/答案(back) JSON 结构。
- 支持 CSV 导入导出卡片。
- 编辑测验模板关联：可生成/保存测验模板的题目顺序。
- 删除卡片时需用户确认。

### 3.5 闪卡练习（DeckPractice）
- 入口：`/decks/:deckName/practice`（路径使用 deck title/path，需 URL 编码）。
- 通过 RPC `select_practice_cards` 抽取一组卡片（支持模式与数量参数）。
- 显示卡片正反面，支持翻转、上一题/下一题。
- 展示本轮计数、每张卡的练习次数、熟练度指示与整体完成度环形图。
- 每答一张记录难度（1~4 对应 ease_factor），写入：
  - `card_reviews`：新增记录，包含用户、卡片、时间、难度。
  - `card_stats`：累计 review_count、ease_factor、last_reviewed_at。
- 达到阈值进入休息界面，可继续下一轮或结束返回目录。
- 全局计时器：练习阶段计时，查看答案/休息时暂停。

### 3.6 测验运行（QuizRun）
- 入口：`/quizzes/:templateId/take`。
- 加载 `quiz_templates` 及关联卡片，按模板顺序出题。
- 支持题型：基础、单选、多选、填空（题干/答案 JSON 解析自 `quizFormat`）。
- 提交答案后判分，展示对错状态与标准答案；按题记分（默认 1 分，可配置 score）。
- 记录用户作答到 `card_reviews`（含位置、分值、题型等元数据）。
- 完成后汇总正确数、得分比例，保存到 `quiz_runs`（含答案明细），显示完成页并可返回。
- 全局计时器：答题计时，查看答案时暂停。

### 3.7 公共组件/体验
- 顶栏（`AppLayout`）：LOGO、计时器、用户信息/登录按钮。
- 按钮、卡片、确认对话框等基础 UI 组件，支持亮/暗主题。
- Tailwind v4 样式，保持响应式布局（主要宽度 5xl 内）。

## 4. 数据与外部依赖
- Supabase 表/视图/RPC（前端使用）：
  - `decks`，`cards`，`card_stats`，`card_reviews`
  - `quiz_templates`，`quiz_runs`
  - 视图：`deck_folder_stats`，`quiz_template_stats`
  - RPC：`select_practice_cards`
- 环境变量：`VITE_SUPABASE_URL`，`VITE_SUPABASE_ANON_KEY`（存放于 `.env.local`）。
- 主要依赖：React 19、React Router 7、Supabase JS、Tailwind v4、Lucide 图标、PapaParse（CSV）。

## 5. 约束与体验要求
- 需在登录后才能进行 Deck 创建/编辑/练习/测验结果写入等需要用户身份的操作。
- 界面支持中英文内容混排，默认暗色主题优化。
- 计时器为全局单实例，页面进入练习/测验时重置并按状态启动/暂停。
- 兼容旧数据：题干/答案若为纯文本，解析为 basic 题型；答案文本按多行/空行拆分候选与解析说明。

## 6. 待明确问题
- 权限/RLS 具体规则（是否限制用户仅能访问自己的 Deck / 结果）。
- `select_practice_cards` 的抽题策略与参数（如按难度、随机、上次错误优先）。
- 题库/测验的分享或协作需求（当前未覆盖）。
- 多语言/国际化是否需要统一方案。
